# Maintainer: Zelun Kong <zelun.kong@outlook.com>

pkgname=openldap
pkgver=2.6.4
pkgrel=3
epoch=
pkgdesc="Lightweight Directory Access Protocol (LDAP) client libraries"
arch=('x86_64')
url="https://www.openldap.org"
license=('KZL')
depends=(cyrus-sasl)
source=($url/software/download/OpenLDAP/openldap-release/$pkgname-$pkgver.tgz{,.asc})
validpgpkeys=('3CE269B5398BC8B785645E987F67D5FD1CE1CBCE')
sha256sums=('d51704e50178430c06cf3d8aa174da66badf559747a47d920bb54b2d4aa40991'
            'SKIP')

build() {
  cd $pkgname-$pkgver

  ./configure \
    --prefix=/usr \
    --sysconfdir=/etc \
    --localstatedir=/var/lib/openldap \
    --enable-debug=no \
    --enable-dynamic=yes \
    \
    --enable-slapd=no \
    \
    --enable-backends=no \
    \
    --enable-overlays=no \
    \
    --enable-static=no \
    --enable-versioning=yes \
    \
    --with-cyrus-sasl

  make depend
  make
}

check() {
  cd $pkgbase-$pkgver

  make test
}

package() {
  cd $pkgname-$pkgver

  make DESTDIR="$pkgdir" install

  # for dir in include libraries doc/man/man3 ; do
  #   pushd $dir
  #   make DESTDIR="$pkgdir/" install
  #   popd
  # done

  # install -Dm644 doc/man/man5/ldap.conf.5.tmp "$pkgdir"/usr/share/man/man5/ldap.conf.5

  # ln -sf liblber.so "$pkgdir"/usr/lib/liblber.so.2
  # ln -sf libldap.so "$pkgdir"/usr/lib/libldap.so.2

  # rm "$pkgdir"/etc/openldap/*.default
}
