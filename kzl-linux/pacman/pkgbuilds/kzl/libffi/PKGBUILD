# Maintainer: Zelun Kong <zelun.kong@outlook.com>

pkgname=libffi
pkgver=3.4.6
pkgrel=1
epoch=
pkgdesc="A Portable Foreign Function Interface Library"
arch=('x86_64')
url="https://sourceware.org/libffi/"
license=('KZL')
makedepends=(
  libtool
)
options=(!lto)
source=(
  ## not compatible with autoconf 2.72
  # git+https://github.com/libffi/libffi.git#tag=v$pkgver
  # git+https://github.com/libffi/libffi.git
  https://github.com/libffi/libffi/releases/download/v$pkgver/libffi-$pkgver.tar.gz
)
sha256sums=('b0dea9df23c863a7a50e825440f3ebffabd65df1497108e5d437747843895a4e')

# pkgver() {
#   cd $pkgname

#   git describe --tags | sed 's/^v//;s/-g.*//;s/-/.g/'
# }

# prepare() {
#   cd $pkgname

#   autoupdate -vf
#   ./autogen.sh
# }

build() {
  cd $pkgname-$pkgver

  ./configure \
    --prefix=/usr \
    --disable-docs

  make
}

check() {
  cd $pkgname-$pkgver

  make check
}

package() {
  cd $pkgname-$pkgver

  make DESTDIR="$pkgdir" install
}
